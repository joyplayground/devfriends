# 应用容器

1. 容器包含，公共服务，公共过滤器，一组应用
2. 应用包含 私有服务，私有过滤器

#  运行起来应该是什么样子的

## 启动
1. 容器加载，加载完成后开始启动
2. 容器开始加载应用
3. 分析应用依赖的服务和过滤器
4. 懒加载服务和过滤器
5. 应用注册私有过滤器和服务
6. 应用加载完成，开始启动

## 渲染
1. 应用计算出来初始状态
2. worker 线程中合成 html 模板
3. worker 中 diff 出来最小结果
4. worker 发送结果到主线程，开始更新 html
5. 界面更新完成

## 事件响应
1. 用户事件触发
2. 主线程传递点击事件到 worker 线程
3. worker 线程处理事件完毕
4. 应用状态发生变化
5. worker 合成新的 html 模板
6. worker diff 最小结果
7. 主线程更新html

## 调用公共服务
1. 应用发起调用
2. 执行过滤器
3. 调用服务
4. 返回结果

## 应用间通信AppChannel
1. 应用 a 注册  ch
2. 应用 a 往 ch 中发送数据
3. 应用 b 注册 AppChannel ch
4. 应用 b 从 ch 中接受消息或者发送消息
5. 建立类似点到点的类似 socket 的通信机制

## 路由
1. 建立全局路由统一跳转控制
2. App-View-Seq 命名

## 容器事件
1. 应用可以监听容器级别的事件，来做出相应的响应

# 线程规划

1. html 的操作和交互事件发生在主线程
2. 业务逻辑和页面更新逻辑算法发生在 work 线程

# 内存规划
1. 渲染模块按照统一的方式来做，一份底层框架。节省框架以及工具相关的代码占用空间
2. 服务可以抽取为公共服务
3. pwa desktop 对多窗口支持不太友好，所以，暂时考虑做成巨型单页应用。每个 app 都挂载到特定的 dom 节点上。
4. 历史的 dom 节点需要移除掉，需要考虑如何缓存 DOM 树

# 资源缓存规划
1. js css 均采用 preache 的方式来做
2. 由于客户端存储size 限制，数据缓存分成三中类型来做
   1. 文档编辑类的，本地实时缓存；socket 远程即时缓存。
   2. 接口请求统一无缓存
   3. 应用状态等，内存管理
   4. 应用个性化配置等，cache 缓存

# UI 设计语言
考虑主流的设计语言风格。

